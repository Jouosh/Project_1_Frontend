<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>See The Meets</title>
</head>
<body>
    
    <label for = "complaintIdInput">I'd like to attach complaint: </label>
    <input id = "complaintIdInput" type = "number" />

    <label for = "meetingIdInput">To meeting: </label>
    <input id = "meetingIdInput" type = "number" />

    <button id = "updateBtn">Submit</button>

    <label for = "complaintTable">List of complaints</label>
    <table id = "complaintTable">

        <thead>
            <tr><th>ID</th><th>Description</th><th>Meeting</th><th>Status</th></tr>
        </thead>

        <tbody id = "complaintTableBody">

        </tbody>

    </table>

    <label for = "meetingTable">List of meetings</label>
    <table id = "meetingTable">

        <thead>
            <tr><th>ID</th><th>Description</th><th>Place</th><th>time</th></tr>
        </thead>

        <tbody id = "meetingTableBody">

        </tbody>

    </table>

</body>

<script>

    const meetingTableBody = document.getElementById("meetingTableBody");
    const complaintTableBody = document.getElementById("complaintTableBody");

    const complaintIdInput = document.getElementById("complaintIdInput");
    const meetingIdInput = document.getElementById("meetingIdInput");
    const updateBtn = document.getElementById("updateBtn");

    async function getComplaints() {
        const httpResponse = await fetch("http://localhost:8080/complaints");
        const complaints = httpResponse.json();
        return complaints;
    }

    async function renderComplaintTable() {

        const complaints = await getComplaints();

        for (const complaint of complaints) {

            const complaintRow = document.createElement("tr");

            const complaintIdData = document.createElement("td");
            complaintIdData.innerText = complaint.complaintId;

            const complaintDescriptionData = document.createElement("td");
            complaintDescriptionData.innerText = complaint.description;

            const complaintMeetingData = document.createElement("td");
            complaintMeetingData.innerText = complaint.meeting;

            const complaintStatusData = document.createElement("td");
            complaintStatusData.innerText = complaint.status;

            complaintRow.appendChild(complaintIdData);
            complaintRow.appendChild(complaintDescriptionData);
            complaintRow.appendChild(complaintMeetingData);
            complaintRow.appendChild(complaintStatusData);

            complaintTableBody.appendChild(complaintRow);
        }

    }

    async function getMeetings() {
        const httpResponse = await fetch("http://localhost:8080/meetings");
        const meetings = httpResponse.json();
        return meetings;
    }

    async function renderMeetingTable() {

        const meetings = await getMeetings();

        for (const meeting of meetings) {

            const meetingRow = document.createElement("tr");

            const meetingIdData = document.createElement("td");
            meetingIdData.innerText = meeting.meetingId;

            const meetingDescriptionData = document.createElement("td");
            meetingDescriptionData.innerText = meeting.description;

            const meetingPlaceData = document.createElement("td");
            meetingPlaceData.innerText = meeting.place;

            const meetingTimeData = document.createElement("td");
            meetingTimeData.innerText = meeting.time;

            meetingRow.appendChild(meetingIdData);
            meetingRow.appendChild(meetingDescriptionData);
            meetingRow.appendChild(meetingPlaceData);
            meetingRow.appendChild(meetingTimeData);

            meetingTableBody.appendChild(meetingRow);
        }

    }

    updateBtn.addEventListener("click", async (event) => {

        const complaintId = String(complaintIdInput.value);
        const complaintRoute = "http://localhost:8080/complaints/" + complaintId;
        const httpGetResponse = await fetch(complaintRoute);
        const complaint = await httpGetResponse.json();

        if (httpGetResponse.status === 404) {
            alert("No complaint with id of " + complaintId + " exists.");
            return;
        }

        complaint.meeting = meetingIdInput.value;
        const httpUpdateResponse = await fetch(complaintRoute, {
            method:"PUT",
            body: JSON.stringify(complaint),
            headers: {
                "Content-Type": "application/json"
            }
        });

        alert("update complete");
        location.reload();

    });

    renderComplaintTable();
    renderMeetingTable();

</script>
</html>